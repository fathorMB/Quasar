(function(x,l){typeof exports=="object"&&typeof module<"u"?l(exports,require("react"),require("axios"),require("@microsoft/signalr"),require("react-router-dom")):typeof define=="function"&&define.amd?define(["exports","react","axios","@microsoft/signalr","react-router-dom"],l):(x=typeof globalThis<"u"?globalThis:x||self,l(x.QuasarUiReact={},x.React,x.axios,x.signalR,x.ReactRouterDOM))})(this,(function(x,l,D,le,k){"use strict";function ue(t){const n=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(t){for(const r in t)if(r!=="default"){const m=Object.getOwnPropertyDescriptor(t,r);Object.defineProperty(n,r,m.get?m:{enumerable:!0,get:()=>t[r]})}}return n.default=t,Object.freeze(n)}const de=ue(le);var O={exports:{}},C={};var Q;function me(){if(Q)return C;Q=1;var t=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function r(m,i,c){var h=null;if(c!==void 0&&(h=""+c),i.key!==void 0&&(h=""+i.key),"key"in i){c={};for(var u in i)u!=="key"&&(c[u]=i[u])}else c=i;return i=c.ref,{$$typeof:t,type:m,key:h,ref:i!==void 0?i:null,props:c}}return C.Fragment=n,C.jsx=r,C.jsxs=r,C}var A={};var V;function fe(){return V||(V=1,process.env.NODE_ENV!=="production"&&(function(){function t(e){if(e==null)return null;if(typeof e=="function")return e.$$typeof===Te?null:e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case S:return"Fragment";case M:return"Profiler";case te:return"StrictMode";case Ne:return"Suspense";case ke:return"SuspenseList";case _e:return"Activity"}if(typeof e=="object")switch(typeof e.tag=="number"&&console.error("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),e.$$typeof){case T:return"Portal";case E:return e.displayName||"Context";case _:return(e._context.displayName||"Context")+".Consumer";case P:var o=e.render;return e=e.displayName,e||(e=o.displayName||o.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case ye:return o=e.displayName||null,o!==null?o:t(e.type)||"Memo";case F:o=e._payload,e=e._init;try{return t(e(o))}catch{}}return null}function n(e){return""+e}function r(e){try{n(e);var o=!1}catch{o=!0}if(o){o=console;var p=o.error,v=typeof Symbol=="function"&&Symbol.toStringTag&&e[Symbol.toStringTag]||e.constructor.name||"Object";return p.call(o,"The provided key is an unsupported type %s. This value must be coerced to a string before using it here.",v),n(e)}}function m(e){if(e===S)return"<>";if(typeof e=="object"&&e!==null&&e.$$typeof===F)return"<...>";try{var o=t(e);return o?"<"+o+">":"<...>"}catch{return"<...>"}}function i(){var e=Y.A;return e===null?null:e.getOwner()}function c(){return Error("react-stack-top-frame")}function h(e){if(ne.call(e,"key")){var o=Object.getOwnPropertyDescriptor(e,"key").get;if(o&&o.isReactWarning)return!1}return e.key!==void 0}function u(e,o){function p(){ae||(ae=!0,console.error("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://react.dev/link/special-props)",o))}p.isReactWarning=!0,Object.defineProperty(e,"key",{get:p,configurable:!0})}function g(){var e=t(this.type);return re[e]||(re[e]=!0,console.error("Accessing element.ref was removed in React 19. ref is now a regular prop. It will be removed from the JSX Element type in a future release.")),e=this.props.ref,e!==void 0?e:null}function f(e,o,p,v,I,W){var w=p.ref;return e={$$typeof:y,type:e,key:o,props:p,_owner:v},(w!==void 0?w:null)!==null?Object.defineProperty(e,"ref",{enumerable:!1,get:g}):Object.defineProperty(e,"ref",{enumerable:!1,value:null}),e._store={},Object.defineProperty(e._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:0}),Object.defineProperty(e,"_debugInfo",{configurable:!1,enumerable:!1,writable:!0,value:null}),Object.defineProperty(e,"_debugStack",{configurable:!1,enumerable:!1,writable:!0,value:I}),Object.defineProperty(e,"_debugTask",{configurable:!1,enumerable:!1,writable:!0,value:W}),Object.freeze&&(Object.freeze(e.props),Object.freeze(e)),e}function a(e,o,p,v,I,W){var w=o.children;if(w!==void 0)if(v)if(Se(w)){for(v=0;v<w.length;v++)d(w[v]);Object.freeze&&Object.freeze(w)}else console.error("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else d(w);if(ne.call(o,"key")){w=t(e);var R=Object.keys(o).filter(function(Ee){return Ee!=="key"});v=0<R.length?"{key: someKey, "+R.join(": ..., ")+": ...}":"{key: someKey}",ce[w+v]||(R=0<R.length?"{"+R.join(": ..., ")+": ...}":"{}",console.error(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,v,w,R,w),ce[w+v]=!0)}if(w=null,p!==void 0&&(r(p),w=""+p),h(o)&&(r(o.key),w=""+o.key),"key"in o){p={};for(var z in o)z!=="key"&&(p[z]=o[z])}else p=o;return w&&u(p,typeof e=="function"?e.displayName||e.name||"Unknown":e),f(e,w,p,i(),I,W)}function d(e){b(e)?e._store&&(e._store.validated=1):typeof e=="object"&&e!==null&&e.$$typeof===F&&(e._payload.status==="fulfilled"?b(e._payload.value)&&e._payload.value._store&&(e._payload.value._store.validated=1):e._store&&(e._store.validated=1))}function b(e){return typeof e=="object"&&e!==null&&e.$$typeof===y}var N=l,y=Symbol.for("react.transitional.element"),T=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),te=Symbol.for("react.strict_mode"),M=Symbol.for("react.profiler"),_=Symbol.for("react.consumer"),E=Symbol.for("react.context"),P=Symbol.for("react.forward_ref"),Ne=Symbol.for("react.suspense"),ke=Symbol.for("react.suspense_list"),ye=Symbol.for("react.memo"),F=Symbol.for("react.lazy"),_e=Symbol.for("react.activity"),Te=Symbol.for("react.client.reference"),Y=N.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ne=Object.prototype.hasOwnProperty,Se=Array.isArray,J=console.createTask?console.createTask:function(){return null};N={react_stack_bottom_frame:function(e){return e()}};var ae,re={},oe=N.react_stack_bottom_frame.bind(N,c)(),ie=J(m(c)),ce={};A.Fragment=S,A.jsx=function(e,o,p){var v=1e4>Y.recentlyCreatedOwnerStacks++;return a(e,o,p,!1,v?Error("react-stack-top-frame"):oe,v?J(m(e)):ie)},A.jsxs=function(e,o,p){var v=1e4>Y.recentlyCreatedOwnerStacks++;return a(e,o,p,!0,v?Error("react-stack-top-frame"):oe,v?J(m(e)):ie)}})()),A}var G;function he(){return G||(G=1,process.env.NODE_ENV==="production"?O.exports=me():O.exports=fe()),O.exports}var s=he();const B=l.createContext(void 0),pe=({children:t})=>{const[n,r]=l.useState([]),m=n.filter(g=>!g.read).length,i=g=>{const f={...g,id:Math.random().toString(36).substring(2,9),timestamp:new Date,read:!1};r(a=>[f,...a].slice(0,50))},c=g=>{r(f=>f.map(a=>a.id===g?{...a,read:!0}:a))},h=()=>{r(g=>g.map(f=>({...f,read:!0})))},u=()=>{r([])};return s.jsx(B.Provider,{value:{notifications:n,unreadCount:m,addNotification:i,markAsRead:c,markAllAsRead:h,clearNotifications:u},children:t})},H=()=>{const t=l.useContext(B);if(!t)throw new Error("useNotifications must be used within a NotificationProvider");return t},j=D.create({baseURL:"/auth",headers:{"Content-Type":"application/json"},withCredentials:!0});j.interceptors.request.use(t=>{const n=localStorage.getItem("accessToken");return n&&(t.headers.Authorization=`Bearer ${n}`),t},t=>Promise.reject(t)),j.interceptors.response.use(t=>t,async t=>{const n=t.config;if(t.response?.status===401&&n){const c=localStorage.getItem("refreshToken");if(c&&!n._retry){n._retry=!0;try{const h=await D.post("/auth/token/refresh",{refreshToken:c}),{accessToken:u,refreshToken:g}=h.data;return localStorage.setItem("accessToken",u),localStorage.setItem("refreshToken",g),n.headers.Authorization=`Bearer ${u}`,j(n)}catch(h){return localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),window.location.href="/login",Promise.reject(h)}}}const r=t.config?.url?.endsWith("/login"),m=t.response?.data;if(t.response?.status===401&&m?.code==="SESSION_REVOKED"){localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),window.dispatchEvent(new CustomEvent("session-revoked",{detail:{message:m.message}}));const c={message:m.message,statusCode:401};return Promise.reject(c)}const i={message:t.response?.status===401&&r?"Invalid username or password":m?.message||t.message||"An error occurred",statusCode:t.response?.status||500};return Promise.reject(i)});const X={login:async t=>{const n=await j.post("/login",t);return localStorage.setItem("accessToken",n.data.accessToken),localStorage.setItem("refreshToken",n.data.refreshToken),n.data},register:async t=>(await j.post("/register",t)).data,refreshToken:async t=>{const n=await j.post("/token/refresh",t);return localStorage.setItem("accessToken",n.data.accessToken),localStorage.setItem("refreshToken",n.data.refreshToken),n.data},logout:async()=>{const t=localStorage.getItem("refreshToken");if(t)try{await j.post("/logout",{refreshToken:t})}catch(n){console.error("Logout error:",n)}localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken")},isAuthenticated:()=>!!localStorage.getItem("accessToken")},Z={list:async()=>(await j.get("/users")).data,getRoles:async t=>(await j.get(`/users/${t}/roles`)).data,getPermissions:async t=>(await j.get(`/users/${t}/permissions`)).data,assignRole:async(t,n)=>{await j.post(`/users/${t}/roles`,n)},revokeRole:async(t,n)=>{await j.delete(`/users/${t}/roles/${n}`)},resetPassword:async t=>(await j.post(`/users/${t}/reset-password`)).data.password,resetOwnPassword:async()=>(await j.post("/users/me/reset-password")).data.password,delete:async t=>{await j.delete(`/users/${t}`)}},K=l.createContext(void 0),U=()=>{const t=l.useContext(K);if(!t)throw new Error("useAuth must be used within an AuthProvider");return t},ge=({children:t})=>{const[n,r]=l.useState(null),[m,i]=l.useState(!0);l.useEffect(()=>{c()},[]);const c=async()=>{try{const a=localStorage.getItem("accessToken");if(a){const d=h(a);console.log("Decoded payload:",d);const b=d.sub,N=d.unique_name||d.name||"User";let y=[];try{console.log("Fetching roles for userId:",b);const T=await Z.getRoles(b);console.log("Fetched userRoles:",T),y=T.map(S=>S.name),console.log("Mapped roles:",y)}catch(T){console.error("Failed to fetch roles",T)}r({id:b,username:N,email:d.email||"",roles:y})}else r(null)}catch(a){console.error("Auth check failed:",a),r(null)}finally{i(!1)}};function h(a){var d=a.split(".")[1],b=d.replace(/-/g,"+").replace(/_/g,"/"),N=decodeURIComponent(window.atob(b).split("").map(function(y){return"%"+("00"+y.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(N)}const f={user:n,isAuthenticated:!!n,isLoading:m,login:async a=>{i(!0);try{await X.login(a),await c()}catch(d){throw r(null),d}finally{i(!1)}},logout:async()=>{i(!0);try{await X.logout()}catch(a){console.error("Logout error:",a)}finally{r(null),i(!1)}}};return s.jsx(K.Provider,{value:f,children:t})},q=l.createContext(void 0),ve=({children:t})=>{const[n,r]=l.useState(null),[m,i]=l.useState(!0),[c,h]=l.useState([]),[u,g]=l.useState([]);return l.useEffect(()=>{(async()=>{try{const a=await fetch("/api/config/ui");if(a.ok){const d=await a.json();r(d);const b=`theme-${d.theme||"dark"}`;document.documentElement.className=b}}catch(a){console.error("Failed to fetch UI settings:",a),document.documentElement.className="theme-dark"}finally{i(!1)}})(),Array.isArray(window.__QUASAR_CUSTOM_MENU__)&&h(window.__QUASAR_CUSTOM_MENU__),Array.isArray(window.__QUASAR_CUSTOM_ROUTES__)&&g(window.__QUASAR_CUSTOM_ROUTES__)},[]),s.jsx(q.Provider,{value:{settings:n,isLoading:m,customMenu:c,customRoutes:u},children:t})},L=()=>{const t=l.useContext(q);if(!t)throw new Error("useUi must be used within a UiProvider");return t};class we{connection=null;listeners=[];async start(){if(!this.connection){this.connection=new de.HubConnectionBuilder().withUrl("/hubs/notifications").withAutomaticReconnect().build(),this.connection.on("ReceiveNotification",n=>{this.listeners.forEach(r=>r(n))});try{await this.connection.start(),console.log("Notification SignalR Connected")}catch(n){console.error("Notification SignalR Connection Error: ",n),this.connection=null}}}stop(){this.connection&&(this.connection.stop(),this.connection=null)}subscribe(n){return this.listeners.push(n),()=>{this.listeners=this.listeners.filter(r=>r!==n)}}}const $=new we,ee=()=>{const{notifications:t,unreadCount:n,addNotification:r,markAsRead:m,markAllAsRead:i}=H(),[c,h]=l.useState(!1),u=l.useRef(null);l.useEffect(()=>{const a=$.subscribe(d=>{r({title:d.title,message:d.message,type:d.type})});return $.start(),()=>{a()}},[r]),l.useEffect(()=>{const a=d=>{u.current&&!u.current.contains(d.target)&&h(!1)};return c&&document.addEventListener("mousedown",a),()=>{document.removeEventListener("mousedown",a)}},[c]);const g=a=>{const b=new Date().getTime()-a.getTime(),N=Math.floor(b/6e4);if(N<1)return"Just now";if(N<60)return`${N}m ago`;const y=Math.floor(N/60);return y<24?`${y}h ago`:a.toLocaleDateString()},f=a=>{m(a)};return s.jsxs("div",{className:"notifications-container",ref:u,children:[s.jsxs("button",{className:"bell-button",onClick:()=>h(!c),"aria-label":"Notifications",children:[s.jsx("span",{children:"ðŸ””"}),n>0&&s.jsx("span",{className:"notification-badge",children:n>9?"9+":n})]}),c&&s.jsxs("div",{className:"notifications-dropdown",children:[s.jsxs("div",{className:"notifications-header",children:[s.jsx("h3",{children:"Notifications"}),n>0&&s.jsx("button",{className:"mark-all-btn",onClick:i,children:"Mark all as read"})]}),s.jsx("div",{className:"notifications-list",children:t.length===0?s.jsx("div",{className:"empty-notifications",children:"No notifications yet"}):t.map(a=>s.jsxs("div",{className:`notification-item ${a.read?"read":"unread"}`,onClick:()=>f(a.id),children:[s.jsxs("div",{className:"notification-item-header",children:[s.jsx("span",{className:`notification-title type-${a.type}`,children:a.title}),s.jsx("span",{className:"notification-time",children:g(a.timestamp)})]}),s.jsx("div",{className:"notification-message",children:a.message})]},a.id))})]})]})},se=()=>{const{user:t,logout:n}=U(),[r,m]=l.useState(!1),[i,c]=l.useState(null),[h,u]=l.useState(!1),[g,f]=l.useState(!1),a=k.useNavigate(),d=l.useRef(null),b=async()=>{await n(),a("/login")},N=async()=>{u(!0),m(!1)},y=async()=>{try{const _=await Z.resetOwnPassword();c(_),u(!1)}catch(_){console.error("Failed to change password:",_),alert("Failed to change password"),u(!1)}};l.useEffect(()=>{const _=E=>{d.current&&!d.current.contains(E.target)&&m(!1)};return document.addEventListener("mousedown",_),()=>{document.removeEventListener("mousedown",_)}},[]);const{pathname:T}=k.useLocation(),{customMenu:S}=L(),M=(()=>{const E=(S.length>0?S:window.__QUASAR_CUSTOM_MENU__||[]).flatMap(P=>P.items).find(P=>P.path===T);if(E)return E.label;switch(T){case"/":return"Dashboard";case"/users":return"Users";case"/roles":return"Roles";case"/features":return"Features";case"/jobs":return"Jobs";case"/logs":return"Logs";case"/metrics":return"Metrics";case"/sessions":return"Sessions";default:return"Dashboard"}})();return s.jsxs(s.Fragment,{children:[s.jsxs("header",{className:"app-header",children:[s.jsx("div",{className:"header-left",children:s.jsx("h2",{className:"page-title",children:M})}),s.jsxs("div",{className:"header-right",children:[s.jsx(ee,{}),s.jsxs("div",{className:"user-profile",children:[s.jsxs("div",{className:"user-info",children:[s.jsx("span",{className:"user-name",children:t?.username||"Guest"}),s.jsx("span",{className:"user-role",children:t?.roles?.[0]||"User"})]}),s.jsx("div",{className:"user-avatar",children:t?.username?.charAt(0).toUpperCase()||"U"})]}),s.jsxs("div",{className:"menu-container",ref:d,children:[s.jsx("button",{className:"menu-button","aria-label":"Menu",onClick:()=>m(!r),children:s.jsx("span",{className:"menu-icon",children:"â‹®"})}),r&&s.jsxs("div",{className:"dropdown-menu",children:[s.jsx("button",{onClick:N,className:"dropdown-item",children:"Change Password"}),s.jsx("button",{onClick:b,className:"dropdown-item danger",children:"Sign Out"})]})]})]})]}),h&&s.jsx("div",{className:"modal-overlay",onClick:()=>u(!1),children:s.jsxs("div",{className:"modal",onClick:_=>_.stopPropagation(),children:[s.jsxs("div",{className:"modal-header",children:[s.jsx("h2",{className:"modal-title",children:"Confirm Password Change"}),s.jsx("button",{className:"modal-close",onClick:()=>u(!1),children:"Ã—"})]}),s.jsxs("div",{className:"modal-body",children:[s.jsx("p",{children:"Generate a new password?"}),s.jsx("p",{className:"text-muted",style:{marginTop:"var(--spacing-md)"},children:"You will be logged out and need to login with the new password."}),s.jsxs("div",{style:{display:"flex",gap:"var(--spacing-md)",marginTop:"var(--spacing-lg)"},children:[s.jsx("button",{className:"btn btn-secondary",onClick:()=>u(!1),style:{flex:1},children:"Cancel"}),s.jsx("button",{className:"btn btn-primary",onClick:y,style:{flex:1},children:"Change Password"})]})]})]})}),i&&s.jsx("div",{className:"modal-overlay",onClick:()=>{c(null),b()},children:s.jsxs("div",{className:"modal",onClick:_=>_.stopPropagation(),children:[s.jsx("div",{className:"modal-header",children:s.jsx("h2",{className:"modal-title",children:"Password Changed Successfully"})}),s.jsxs("div",{className:"modal-body",children:[s.jsx("p",{children:"Your new password is:"}),s.jsxs("div",{className:"password-display",style:{display:"flex",alignItems:"center",gap:"var(--spacing-md)",padding:"var(--spacing-md)",background:"var(--color-bg-secondary)",borderRadius:"var(--radius-md)"},children:[s.jsx("code",{style:{flex:1,fontSize:"var(--font-size-base)",fontWeight:"bold"},children:i}),s.jsx("button",{className:"btn btn-sm btn-secondary",onClick:()=>{navigator.clipboard.writeText(i),f(!0),setTimeout(()=>f(!1),2e3)},children:g?"âœ“ Copied!":"ðŸ“‹ Copy"})]}),s.jsx("p",{className:"warning",style:{marginTop:"var(--spacing-md)",padding:"var(--spacing-md)",background:"var(--color-warning-bg)",border:"1px solid var(--color-warning)",borderRadius:"var(--radius-md)"},children:"âš ï¸ Save this password now. You will be logged out."}),s.jsx("button",{className:"btn btn-primary",onClick:()=>{c(null),b()},style:{marginTop:"var(--spacing-lg)",width:"100%"},children:"Logout Now"})]})]})})]})},xe=l.createContext(void 0),be=()=>{const t=l.useContext(xe);if(!t)throw new Error("useFeatures must be used within a FeatureProvider");return t},je=()=>{const{user:t,logout:n}=U(),{settings:r,customMenu:m}=L(),{hasFeature:i}=be(),c=k.useNavigate(),h=async()=>{await n(),c("/login")};return s.jsxs("div",{className:"main-layout",children:[s.jsxs("aside",{className:"sidebar",children:[s.jsx("div",{className:"sidebar-header",children:s.jsxs("div",{className:"logo",children:[s.jsx("div",{className:"logo-icon",children:r?.logoSymbol||"Q"}),s.jsx("span",{className:"logo-text",children:r?.applicationName||"Quasar"})]})}),s.jsxs("nav",{className:"sidebar-nav",children:[m.map((u,g)=>s.jsxs("div",{className:"nav-section",children:[u.title&&s.jsx("h3",{className:"nav-section-title",children:u.title}),u.items.map((f,a)=>f.roles&&!f.roles.some(d=>t?.roles?.includes(d))||f.feature&&!i(f.feature)?null:s.jsx(k.Link,{to:f.path,className:"nav-link",children:s.jsx("span",{children:f.label})},`custom-item-${a}-${f.path}`))]},`custom-${g}`)),t?.roles?.includes("administrator")&&r?.showAdminMenu!==!1&&s.jsxs("div",{className:"nav-section",children:[s.jsx("h3",{className:"nav-section-title",children:"Administration"}),s.jsx(k.Link,{to:"/users",className:"nav-link",children:s.jsx("span",{children:"Users"})}),s.jsx(k.Link,{to:"/roles",className:"nav-link",children:s.jsx("span",{children:"Roles"})}),s.jsx(k.Link,{to:"/features",className:"nav-link",children:s.jsx("span",{children:"Features"})}),s.jsx(k.Link,{to:"/logs",className:"nav-link",children:s.jsx("span",{children:"Logs"})}),s.jsx(k.Link,{to:"/sessions",className:"nav-link",children:s.jsx("span",{children:"Sessions"})}),i("scheduler")&&s.jsx(k.Link,{to:"/jobs",className:"nav-link",children:s.jsx("span",{children:"Jobs"})}),i("telemetry")&&s.jsx(k.Link,{to:"/metrics",className:"nav-link",children:s.jsx("span",{children:"Metrics"})})]})]}),s.jsx("div",{className:"sidebar-footer",children:s.jsx("button",{onClick:h,className:"btn btn-secondary w-full btn-sm",children:"Sign Out"})})]}),s.jsxs("div",{className:"content-wrapper",children:[s.jsx(se,{}),s.jsx("main",{className:`main-content ${k.Outlet?.type?.layoutOptions?.noPadding?"no-padding":""}`,children:s.jsx(k.Outlet,{})})]})]})};x.AuthProvider=ge,x.Header=se,x.MainLayout=je,x.NotificationBell=ee,x.NotificationProvider=pe,x.UiProvider=ve,x.useAuth=U,x.useNotifications=H,x.useUi=L,Object.defineProperty(x,Symbol.toStringTag,{value:"Module"})}));
